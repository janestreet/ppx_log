(library
 (name switch_to_ppx_log_test)
 (libraries async core expect_test_helpers_core.expect_test_helpers_base
   patdiff.expect_test_patdiff)
 (preprocess
  (pps ppx_jane ppx_expect ppx_let)))

(rule
 (targets output.ml)
 (deps
  (:first_dep ../bin/switch_to_ppx_log.exe)
  %{workspace_root}/bin/apply-style
  input.ml
  import.ml
  jbuild)
 (action
  (bash
    "cp input.ml output.ml && %{first_dep} -dir . -glob output.ml -repo . -actually-transform true -mode strict -shared-cache-path $(mktemp -d) 2> /dev/null; echo '(* This file is autogenerated from input.ml. *)' | cat - output.ml | sponge output.ml")))
